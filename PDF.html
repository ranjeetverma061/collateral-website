<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>PDF Tools - Collateral Portal</title>
  
  <!-- Collateral Page Icons & Fonts -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
  <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700&family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet" />
  
  <!-- PDF Tool Libraries -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.11.338/pdf.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.4.0/jspdf.umd.min.js"></script>
  <script src="https://unpkg.com/docx@7.3.0/build/index.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.7.1/jszip.min.js"></script>
  <!-- Added Tesseract.js for OCR -->
  <script src='https://cdn.jsdelivr.net/npm/tesseract.js@2/dist/tesseract.min.js'></script>
  <!-- NEW: Replaced docx-preview with Mammoth.js and html2pdf.js for robust Word to PDF -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/mammoth/1.4.17/mammoth.browser.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>


  <style>
    /* --- Base Styles from Collateral.html --- */
    :root {
      --primary: #006ca7;
      --primary-dark: #005a8c;
      --primary-light: #e1f0fa;
      --accent: #17a2b8;
      --accent-dark: #13899c;
      --bg-light: #f7f9fc;
      --sidebar-bg: #ffffff;
      --sidebar-border: #eef2f7;
      --sidebar-text: #333333;
      --sidebar-hover: #f0f4f9;
      --sidebar-active: #e1f0fa;
      --sidebar-icon: #6c757d;
      --text-primary: #2d3748;
      --text-secondary: #4a5568;
      --transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
      --shadow-sm: 0 1px 3px rgba(0,0,0,0.05), 0 1px 2px rgba(0,0,0,0.1);
      --shadow-md: 0 4px 6px rgba(0,0,0,0.07), 0 1px 3px rgba(0,0,0,0.06);
      --shadow-lg: 0 10px 20px rgba(0,0,0,0.07), 0 6px 6px rgba(0,0,0,0.06);
      --border-radius: 12px;
    }
    .theme-green { --primary: #2e7d32; --primary-dark: #1b5e20; --primary-light: #e8f5e9; --accent: #43a047; --accent-dark: #388e3c; }
    .theme-purple { --primary: #6a1b9a; --primary-dark: #4a148c; --primary-light: #f3e5f5; --accent: #9c27b0; --accent-dark: #7b1fa2; }
    .theme-dark {
      --primary: #37474f; --primary-dark: #263238; --primary-light: #cfd8dc; --accent: #546e7a; --accent-dark: #455a64; --bg-light: #1a1d21; --sidebar-bg: #212529; --sidebar-border: #32383e; --sidebar-text: #f8f9fa; --sidebar-hover: #343a40; --sidebar-active: #0d6efd; --sidebar-icon: #adb5bd; --text-primary: #f8f9fa; --text-secondary: #ced4da;
    }
    .theme-dark .glass-panel { background: rgba(33, 37, 41, 0.7); border-color: var(--sidebar-border); color: var(--text-primary); }
    .theme-dark .tab-btn { color: var(--text-secondary); }
    .theme-dark .tab-btn.active { color: var(--text-primary); background-color: var(--accent); border-color: var(--accent); }
    .theme-dark h1, .theme-dark h2, .theme-dark p { color: var(--text-primary); }
    .theme-dark .text-gray-600 { color: var(--text-secondary) !important; }
    .theme-dark .text-gray-900 { color: var(--text-primary) !important; }
    .theme-dark .drop-zone { border-color: #495057; background-color: rgba(255,255,255,0.05); }
    .theme-dark .drop-zone.dragover { border-color: var(--accent); background-color: rgba(84, 110, 122, 0.2); }
    .theme-dark .bg-gray-100 { background-color: #343a40; }
    .theme-dark .text-gray-800 { color: var(--text-primary) !important; }

    * { box-sizing: border-box; margin: 0; padding: 0; }
    body { margin: 0; font-family: 'Poppins', 'Nunito', sans-serif; background: var(--bg-light); color: var(--text-primary); line-height: 1.6; overflow-x: hidden; transition: background 0.3s ease, color 0.3s ease; }
    .header { display: flex; justify-content: space-between; align-items: center; background: var(--primary); padding: 12px 20px; box-shadow: var(--shadow-md); position: fixed; top: 0; left: 0; right: 0; z-index: 1000; height: 64px; }
    .header-left { display: flex; align-items: center; gap: 12px; }
    .icon { font-size: 1.4em; background: linear-gradient(135deg, var(--primary), var(--accent)); color: white; width: 40px; height: 40px; border-radius: 50%; display: flex; align-items: center; justify-content: center; }
    .header-title { font-size: 1.17em; font-weight: 600; color: #ffffff; }
    .header-nav { display: flex; align-items: center; gap: 10px; }
    .header-nav a { padding: 8px 12px; border-radius: 20px; transition: var(--transition); color: rgba(255, 255, 255, 0.85); text-decoration: none; font-weight: 500; font-size: 0.85em; }
    .header-nav a:hover, .header-nav a.active { background-color: var(--primary-dark); color: #ffffff; }
    .theme-switcher { position: relative; display: flex; align-items: center; margin-left: 10px; }
    .theme-btn { background: transparent; border: 1px solid rgba(255, 255, 255, 0.5); color: #ffffff; width: 36px; height: 36px; border-radius: 50%; display: flex; align-items: center; justify-content: center; cursor: pointer; transition: var(--transition); }
    .theme-btn:hover { background: var(--primary-dark); }
    .theme-options { position: absolute; top: 50px; right: 0; background: var(--sidebar-bg); border-radius: var(--border-radius); box-shadow: var(--shadow-lg); padding: 10px; display: none; flex-direction: column; gap: 8px; z-index: 1001; }
    .theme-options.show { display: flex; }
    .theme-option { display: flex; align-items: center; gap: 8px; padding: 8px 12px; border-radius: 4px; cursor: pointer; transition: var(--transition); }
    .theme-option:hover { background: var(--sidebar-hover); }
    .theme-color { width: 16px; height: 16px; border-radius: 50%; border: 1px solid rgba(0,0,0,0.1); }
    .theme-color.default { background: linear-gradient(135deg, #006ca7, #17a2b8); }
    .theme-color.green { background: linear-gradient(135deg, #2e7d32, #43a047); }
    .theme-color.purple { background: linear-gradient(135deg, #6a1b9a, #9c27b0); }
    .theme-color.dark { background: linear-gradient(135deg, #37474f, #546e7a); }
    .container { display: flex; min-height: 100vh; position: relative; padding-top: 64px; }
    .main { flex: 1; padding: 25px; overflow-y: auto; transition: var(--transition); background-color: var(--bg-light); margin-left: 0; min-height: calc(100vh - 64px); width: 100%; }

    /* --- Styles from PDF.html, adapted for the theme --- */
    .glass-panel {
        background: rgba(255, 255, 255, 0.7);
        backdrop-filter: blur(20px);
        -webkit-backdrop-filter: blur(20px);
        border: 1px solid var(--sidebar-border);
        transition: background 0.3s ease, border-color 0.3s ease;
    }
    .primary-button {
        background-color: var(--primary);
        color: white;
        box-shadow: 0 4px 14px rgba(0, 123, 255, 0.25);
        transition: all 0.3s ease;
        cursor: pointer;
    }
    .primary-button:hover {
        background-color: var(--primary-dark);
        box-shadow: 0 6px 20px rgba(0, 123, 255, 0.3);
    }
    .primary-button:disabled {
        background-color: #a0cfff;
        box-shadow: none;
        cursor: not-allowed;
    }
    .accent-blue-text {
        color: var(--accent);
    }
    .drop-zone {
        border: 2px dashed #cbd5e1;
        transition: all 0.3s ease;
    }
    .drop-zone.dragover {
        border-color: var(--primary);
        background-color: rgba(0, 123, 255, 0.05);
    }
    .spinner {
        border: 4px solid rgba(0, 0, 0, 0.1);
        width: 24px;
        height: 24px;
        border-radius: 50%;
        border-left-color: #fff;
        animation: spin 1s ease infinite;
    }
    @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
    }

    /* --- NEW UI STYLES --- */
    .main-title {
        font-size: 2.5rem;
        font-weight: 800;
        text-align: center;
        color: var(--text-primary);
        margin-bottom: 0.5rem;
    }
    .main-subtitle {
        font-size: 1.125rem;
        text-align: center;
        color: var(--text-secondary);
        margin-bottom: 2.5rem;
    }
    .category-heading {
        font-size: 1.5rem;
        font-weight: 700;
        color: var(--text-primary);
        margin-top: 2rem;
        margin-bottom: 1rem;
        padding-bottom: 0.5rem;
        border-bottom: 2px solid var(--sidebar-border);
    }
    .tab-container {
        display: flex;
        flex-wrap: wrap;
        gap: 0.5rem;
        margin-bottom: 2rem;
    }
    .tab-btn {
        padding: 0.5rem 1rem;
        font-weight: 600;
        cursor: pointer;
        border-radius: 9999px;
        transition: all 0.3s ease;
        color: var(--text-secondary);
        background-color: transparent;
        border: 2px solid transparent;
    }
    .tab-btn:hover {
        background-color: var(--sidebar-hover);
        color: var(--text-primary);
    }
    .tab-btn.active {
        color: #ffffff;
        background-color: var(--primary);
        border-color: var(--primary);
    }
  </style>
</head>
<body>
  <!-- Header from Collateral.html -->
  <div class="header">
    <div class="header-left">
      <span class="icon"><i class="fas fa-file-pdf"></i></span>
      <h2 class="header-title">PDF Tools</h2>
    </div>
    <div class="header-nav">
     <a href="index.html">Go to Collateral Policies</a>
      <div class="theme-switcher">
        <button class="theme-btn" id="themeBtn">
          <i class="fas fa-palette"></i>
        </button>
        <div class="theme-options" id="themeOptions">
          <div class="theme-option" onclick="setTheme('default')"><div class="theme-color default"></div><span>Default</span></div>
          <div class="theme-option" onclick="setTheme('green')"><div class="theme-color green"></div><span>Green</span></div>
          <div class="theme-option" onclick="setTheme('purple')"><div class="theme-color purple"></div><span>Purple</span></div>
          <div class="theme-option" onclick="setTheme('dark')"><div class="theme-color dark"></div><span>Dark</span></div>
        </div>
      </div>
    </div>
  </div>

  <div class="container">
    <!-- Main Content Area -->
    <div class="main" id="mainContent">
      <!-- PDF Tool Content Goes Here -->
      <section class="w-full max-w-4xl mx-auto">
          <div class="glass-panel rounded-2xl p-8 md:p-12">
              <!-- Main Heading -->
              <div class="text-center">
                  <h1 class="main-title">PDF Toolkit</h1>
                  <p class="main-subtitle">Compress, convert, and manage your documents with ease.</p>
              </div>

              <!-- PDF Compressor Category -->
              <div>
                  <h2 class="category-heading">PDF Compressor</h2>
                  <div class="tab-container">
                      <button id="compress-single-tab" class="tab-btn active">Compress Single</button>
                      <button id="compress-multiple-tab" class="tab-btn">Compress Multiple</button>
                  </div>
              </div>

              <!-- PDF Converter Category -->
              <div>
                  <h2 class="category-heading">PDF Converter</h2>
                  <div class="tab-container">
                      <button id="convert-pdf-to-word-tab" class="tab-btn">PDF to Word</button>
                      <button id="image-to-pdf-tab" class="tab-btn">Image to PDF</button>
                      <button id="word-to-pdf-tab" class="tab-btn">Word to PDF</button>
                  </div>
              </div>

              <!-- Tool Sections -->
              <div id="tool-sections-container" class="mt-8">
                <!-- PDF Compressor (Single) Tool Section -->
                <div id="compressor-single-section">
                    <p class="text-gray-600 mb-8 text-center">Reduce the size of a single PDF file and download it directly.</p>
                    
                    <div id="upload-area-compress-single" class="drop-zone rounded-xl p-10 text-center cursor-pointer bg-white/50">
                        <input type="file" id="pdf-upload-compress-single" class="hidden" accept="application/pdf">
                        <div class="flex flex-col items-center">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-16 w-16 text-gray-400 mb-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1"><path stroke-linecap="round" stroke-linejoin="round" d="M7 16a4 4_0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M12 15v4m-3-3l3 3 3-3" /></svg>
                            <p class="text-lg font-semibold text-gray-700">Drag & drop your PDF here</p>
                            <p class="text-gray-500 mt-1">or</p>
                            <button id="browse-btn-compress-single" class="mt-2 font-semibold accent-blue-text">Browse file</button>
                        </div>
                    </div>

                    <div id="processing-area-compress-single" class="hidden mt-6 text-left">
                        <div class="flex items-center justify-between bg-gray-100 p-4 rounded-lg">
                            <div>
                                <p class="font-semibold text-gray-800" id="file-name-compress-single"></p>
                                <p class="text-sm text-gray-500" id="file-size-compress-single"></p>
                            </div>
                            <button id="cancel-btn-compress-single" class="text-red-500 hover:text-red-700 font-semibold">Cancel</button>
                        </div>
                        <div class="mt-6">
                            <label for="quality-slider-single" class="block text-sm font-medium text-gray-700 mb-2">Compression Quality</label>
                            <input id="quality-slider-single" type="range" min="0.1" max="1.0" value="0.7" step="0.1" class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer">
                        </div>
                        <button id="compress-btn-single" class="primary-button w-full py-3 mt-6 rounded-lg font-semibold text-lg flex justify-center items-center">Compress PDF</button>
                        <p id="status-text-compress-single" class="text-center mt-4 text-gray-600"></p>
                    </div>

                    <div id="result-area-compress-single" class="hidden mt-6 text-center">
                        <h3 class="text-2xl font-bold text-green-600">Compression Complete!</h3>
                        <div class="flex justify-around items-center my-6 bg-gray-100 p-4 rounded-lg">
                            <div><p class="text-sm text-gray-500">Original Size</p><p class="font-bold text-lg" id="original-size-single"></p></div>
                            <div><p class="text-sm text-gray-500">New Size</p><p class="font-bold text-lg text-green-600" id="new-size-single"></p></div>
                            <div><p class="text-sm text-gray-500">Reduction</p><p class="font-bold text-lg text-green-600" id="reduction-percent-single"></p></div>
                        </div>
                        <button id="download-btn-compress-single" class="primary-button w-full py-3 rounded-lg font-semibold text-lg">Download PDF</button>
                        <button id="process-another-btn-compress-single" class="mt-4 font-semibold text-gray-600 hover:text-gray-800">Compress Another File</button>
                    </div>
                </div>

                <!-- PDF Compressor (Multiple) Tool Section -->
                <div id="compressor-multiple-section" class="hidden">
                    <p class="text-gray-600 mb-8 text-center">Reduce the size of multiple PDF files and download them in a single zip archive.</p>
                    
                    <div id="upload-area-compress-multiple" class="drop-zone rounded-xl p-10 text-center cursor-pointer bg-white/50">
                        <input type="file" id="pdf-upload-compress-multiple" class="hidden" accept="application/pdf" multiple>
                        <div class="flex flex-col items-center">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-16 w-16 text-gray-400 mb-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1"><path stroke-linecap="round" stroke-linejoin="round" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M12 15v4m-3-3l3 3 3-3" /></svg>
                            <p class="text-lg font-semibold text-gray-700">Drag & drop your PDFs here</p>
                            <p class="text-gray-500 mt-1">or</p>
                            <button id="browse-btn-compress-multiple" class="mt-2 font-semibold accent-blue-text">Browse files</button>
                        </div>
                    </div>

                    <div id="processing-area-compress-multiple" class="hidden mt-6 text-left">
                        <div class="bg-gray-100 p-4 rounded-lg">
                            <div class="flex justify-between items-center mb-2">
                                <p class="font-semibold text-gray-800" id="file-count-compress-multiple"></p>
                                <button id="cancel-btn-compress-multiple" class="text-red-500 hover:text-red-700 font-semibold">Cancel</button>
                            </div>
                            <div id="file-list-compress-multiple" class="max-h-32 overflow-y-auto text-sm text-gray-600"></div>
                        </div>
                        <div class="mt-6">
                            <label for="quality-slider-multiple" class="block text-sm font-medium text-gray-700 mb-2">Compression Quality</label>
                            <input id="quality-slider-multiple" type="range" min="0.1" max="1.0" value="0.7" step="0.1" class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer">
                        </div>
                        <button id="compress-btn-multiple" class="primary-button w-full py-3 mt-6 rounded-lg font-semibold text-lg flex justify-center items-center">Compress Files</button>
                        <p id="status-text-compress-multiple" class="text-center mt-4 text-gray-600"></p>
                    </div>

                    <div id="result-area-compress-multiple" class="hidden mt-6 text-center">
                        <h3 class="text-2xl font-bold text-green-600">Compression Complete!</h3>
                        <div class="flex justify-around items-center my-6 bg-gray-100 p-4 rounded-lg">
                            <div><p class="text-sm text-gray-500">Original Size</p><p class="font-bold text-lg" id="original-size-multiple"></p></div>
                            <div><p class="text-sm text-gray-500">New Size</p><p class="font-bold text-lg text-green-600" id="new-size-multiple"></p></div>
                            <div><p class="text-sm text-gray-500">Reduction</p><p class="font-bold text-lg text-green-600" id="reduction-percent-multiple"></p></div>
                        </div>
                        <button id="download-btn-compress-multiple" class="primary-button w-full py-3 rounded-lg font-semibold text-lg">Download ZIP</button>
                        <button id="process-another-btn-compress-multiple" class="mt-4 font-semibold text-gray-600 hover:text-gray-800">Compress More Files</button>
                    </div>
                </div>

                <!-- PDF to Word Converter Section -->
                <div id="pdf-to-word-section" class="hidden">
                    <p class="text-gray-600 mb-8 text-center">Extract text and images from your PDF and download it as a Word (.docx) document. Now with OCR for text recognition in images.</p>
                    
                    <div id="upload-area-pdf-to-word" class="drop-zone rounded-xl p-10 text-center cursor-pointer bg-white/50">
                        <input type="file" id="pdf-upload-pdf-to-word" class="hidden" accept="application/pdf">
                        <div class="flex flex-col items-center">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-16 w-16 text-gray-400 mb-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1"><path stroke-linecap="round" stroke-linejoin="round" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M12 15v4m-3-3l3 3 3-3" /></svg>
                            <p class="text-lg font-semibold text-gray-700">Drag & drop your PDF here</p>
                            <p class="text-gray-500 mt-1">or</p>
                            <button id="browse-btn-pdf-to-word" class="mt-2 font-semibold accent-blue-text">Browse file</button>
                        </div>
                    </div>

                    <div id="processing-area-pdf-to-word" class="hidden mt-6 text-left">
                        <div class="flex items-center justify-between bg-gray-100 p-4 rounded-lg">
                            <div>
                                <p class="font-semibold text-gray-800" id="file-name-pdf-to-word"></p>
                                <p class="text-sm text-gray-500" id="file-size-pdf-to-word"></p>
                            </div>
                            <button id="cancel-btn-pdf-to-word" class="text-red-500 hover:text-red-700 font-semibold">Cancel</button>
                        </div>
                        <button id="convert-btn-pdf-to-word" class="primary-button w-full py-3 mt-6 rounded-lg font-semibold text-lg flex justify-center items-center">Convert to Word</button>
                        <p id="status-text-pdf-to-word" class="text-center mt-4 text-gray-600"></p>
                    </div>

                    <div id="result-area-pdf-to-word" class="hidden mt-6 text-center">
                        <h3 class="text-2xl font-bold text-green-600">Conversion Complete!</h3>
                        <p class="text-gray-600 my-4">Your document is ready for download.</p>
                        <button id="download-btn-pdf-to-word" class="primary-button w-full py-3 rounded-lg font-semibold text-lg">Download Word Document</button>
                        <button id="process-another-btn-pdf-to-word" class="mt-4 font-semibold text-gray-600 hover:text-gray-800">Convert Another File</button>
                    </div>
                </div>

                <!-- Image to PDF Converter Section -->
                <div id="image-to-pdf-section" class="hidden">
                    <p class="text-gray-600 mb-8 text-center">Combine multiple JPG or PNG images into a single PDF file.</p>
                    
                    <div id="upload-area-image-to-pdf" class="drop-zone rounded-xl p-10 text-center cursor-pointer bg-white/50">
                        <input type="file" id="pdf-upload-image-to-pdf" class="hidden" accept="image/jpeg, image/png" multiple>
                        <div class="flex flex-col items-center">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-16 w-16 text-gray-400 mb-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1"><path stroke-linecap="round" stroke-linejoin="round" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z" /></svg>
                            <p class="text-lg font-semibold text-gray-700">Drag & drop your Images here</p>
                            <p class="text-gray-500 mt-1">or</p>
                            <button id="browse-btn-image-to-pdf" class="mt-2 font-semibold accent-blue-text">Browse files</button>
                        </div>
                    </div>

                    <div id="processing-area-image-to-pdf" class="hidden mt-6 text-left">
                        <div class="bg-gray-100 p-4 rounded-lg">
                            <div class="flex justify-between items-center mb-2">
                                <p class="font-semibold text-gray-800" id="file-count-image-to-pdf"></p>
                                <button id="cancel-btn-image-to-pdf" class="text-red-500 hover:text-red-700 font-semibold">Cancel</button>
                            </div>
                            <div id="file-list-image-to-pdf" class="max-h-32 overflow-y-auto text-sm text-gray-600"></div>
                        </div>
                        <button id="convert-btn-image-to-pdf" class="primary-button w-full py-3 mt-6 rounded-lg font-semibold text-lg flex justify-center items-center">Create PDF</button>
                        <p id="status-text-image-to-pdf" class="text-center mt-4 text-gray-600"></p>
                    </div>

                    <div id="result-area-image-to-pdf" class="hidden mt-6 text-center">
                        <h3 class="text-2xl font-bold text-green-600">PDF Created!</h3>
                        <p class="text-gray-600 my-4">Your PDF document is ready for download.</p>
                        <button id="download-btn-image-to-pdf" class="primary-button w-full py-3 rounded-lg font-semibold text-lg">Download PDF</button>
                        <button id="process-another-btn-image-to-pdf" class="mt-4 font-semibold text-gray-600 hover:text-gray-800">Create Another PDF</button>
                    </div>
                </div>

                <!-- Word to PDF Converter Section -->
                <div id="word-to-pdf-section" class="hidden">
                    <p class="text-gray-600 mb-8 text-center">Upload a .docx file to convert it into a PDF document.</p>
                    
                    <div id="upload-area-word-to-pdf" class="drop-zone rounded-xl p-10 text-center cursor-pointer bg-white/50">
                        <input type="file" id="pdf-upload-word-to-pdf" class="hidden" accept=".doc,.docx,application/msword,application/vnd.openxmlformats-officedocument.wordprocessingml.document">
                        <div class="flex flex-col items-center">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-16 w-16 text-gray-400 mb-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1"><path stroke-linecap="round" stroke-linejoin="round" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" /></svg>
                            <p class="text-lg font-semibold text-gray-700">Drag & drop your Word Document here</p>
                            <p class="text-gray-500 mt-1">or</p>
                            <button id="browse-btn-word-to-pdf" class="mt-2 font-semibold accent-blue-text">Browse file</button>
                        </div>
                    </div>

                    <div id="processing-area-word-to-pdf" class="hidden mt-6 text-left">
                        <div class="flex items-center justify-between bg-gray-100 p-4 rounded-lg">
                            <div>
                                <p class="font-semibold text-gray-800" id="file-name-word-to-pdf"></p>
                                <p class="text-sm text-gray-500" id="file-size-word-to-pdf"></p>
                            </div>
                            <button id="cancel-btn-word-to-pdf" class="text-red-500 hover:text-red-700 font-semibold">Cancel</button>
                        </div>
                        <button id="convert-btn-word-to-pdf" class="primary-button w-full py-3 mt-6 rounded-lg font-semibold text-lg flex justify-center items-center">Convert to PDF</button>
                        <p id="status-text-word-to-pdf" class="text-center mt-4 text-gray-600"></p>
                    </div>

                    <div id="result-area-word-to-pdf" class="hidden mt-6 text-center">
                        <h3 class="text-2xl font-bold text-green-600">Conversion Complete!</h3>
                        <p class="text-gray-600 my-4">Your PDF is ready for download.</p>
                        <button id="download-btn-word-to-pdf" class="primary-button w-full py-3 rounded-lg font-semibold text-lg">Download PDF</button>
                        <button id="process-another-btn-word-to-pdf" class="mt-4 font-semibold text-gray-600 hover:text-gray-800">Convert Another File</button>
                    </div>
                </div>
              </div>
          </div>
      </section>
      <!-- Hidden render target for Word to PDF -->
      <div id="word-render-target" class="hidden"></div>
    </div>
  </div>

<script>
    // --- Combined JavaScript from both files ---

    // --- Portal/Collateral Page Logic ---
    function setTheme(theme) {
      document.body.className = theme ? `theme-${theme}` : '';
      localStorage.setItem('portalTheme', theme);
      document.getElementById('themeOptions').classList.remove('show');
    }

    function toggleThemeOptions() {
      document.getElementById('themeOptions').classList.toggle('show');
    }
    
    // --- PDF Tool Logic ---
    pdfjsLib.GlobalWorkerOptions.workerSrc = `https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.11.338/pdf.worker.min.js`;

    // --- Element Selectors ---
    const tabs = {
        compressSingle: document.getElementById('compress-single-tab'),
        compressMultiple: document.getElementById('compress-multiple-tab'),
        pdfToWord: document.getElementById('convert-pdf-to-word-tab'),
        imageToPdf: document.getElementById('image-to-pdf-tab'),
        wordToPdf: document.getElementById('word-to-pdf-tab'),
    };

    const sections = {
        compressSingle: document.getElementById('compressor-single-section'),
        compressMultiple: document.getElementById('compressor-multiple-section'),
        pdfToWord: document.getElementById('pdf-to-word-section'),
        imageToPdf: document.getElementById('image-to-pdf-section'),
        wordToPdf: document.getElementById('word-to-pdf-section'),
    };
    
    // All UI elements
    const ui = {
        // Compress Single
        uploadAreaCompressSingle: document.getElementById('upload-area-compress-single'),
        processingAreaCompressSingle: document.getElementById('processing-area-compress-single'),
        resultAreaCompressSingle: document.getElementById('result-area-compress-single'),
        pdfUploadCompressSingle: document.getElementById('pdf-upload-compress-single'),
        browseBtnCompressSingle: document.getElementById('browse-btn-compress-single'),
        fileNameCompressSingle: document.getElementById('file-name-compress-single'),
        fileSizeCompressSingle: document.getElementById('file-size-compress-single'),
        cancelBtnCompressSingle: document.getElementById('cancel-btn-compress-single'),
        compressBtnSingle: document.getElementById('compress-btn-single'),
        statusTextCompressSingle: document.getElementById('status-text-compress-single'),
        qualitySliderSingle: document.getElementById('quality-slider-single'),
        originalSizeSingleEl: document.getElementById('original-size-single'),
        newSizeSingleEl: document.getElementById('new-size-single'),
        reductionPercentSingleEl: document.getElementById('reduction-percent-single'),
        downloadBtnCompressSingle: document.getElementById('download-btn-compress-single'),
        processAnotherBtnCompressSingle: document.getElementById('process-another-btn-compress-single'),
        // Compress Multiple
        uploadAreaCompressMultiple: document.getElementById('upload-area-compress-multiple'),
        processingAreaCompressMultiple: document.getElementById('processing-area-compress-multiple'),
        resultAreaCompressMultiple: document.getElementById('result-area-compress-multiple'),
        pdfUploadCompressMultiple: document.getElementById('pdf-upload-compress-multiple'),
        browseBtnCompressMultiple: document.getElementById('browse-btn-compress-multiple'),
        fileCountCompressMultiple: document.getElementById('file-count-compress-multiple'),
        fileListCompressMultiple: document.getElementById('file-list-compress-multiple'),
        cancelBtnCompressMultiple: document.getElementById('cancel-btn-compress-multiple'),
        compressBtnMultiple: document.getElementById('compress-btn-multiple'),
        statusTextCompressMultiple: document.getElementById('status-text-compress-multiple'),
        qualitySliderMultiple: document.getElementById('quality-slider-multiple'),
        originalSizeMultipleEl: document.getElementById('original-size-multiple'),
        newSizeMultipleEl: document.getElementById('new-size-multiple'),
        reductionPercentMultipleEl: document.getElementById('reduction-percent-multiple'),
        downloadBtnCompressMultiple: document.getElementById('download-btn-compress-multiple'),
        processAnotherBtnCompressMultiple: document.getElementById('process-another-btn-compress-multiple'),
        // PDF to Word
        uploadAreaPdfToWord: document.getElementById('upload-area-pdf-to-word'),
        processingAreaPdfToWord: document.getElementById('processing-area-pdf-to-word'),
        resultAreaPdfToWord: document.getElementById('result-area-pdf-to-word'),
        pdfUploadPdfToWord: document.getElementById('pdf-upload-pdf-to-word'),
        browseBtnPdfToWord: document.getElementById('browse-btn-pdf-to-word'),
        fileNamePdfToWord: document.getElementById('file-name-pdf-to-word'),
        fileSizePdfToWord: document.getElementById('file-size-pdf-to-word'),
        cancelBtnPdfToWord: document.getElementById('cancel-btn-pdf-to-word'),
        convertBtnPdfToWord: document.getElementById('convert-btn-pdf-to-word'),
        statusTextPdfToWord: document.getElementById('status-text-pdf-to-word'),
        downloadBtnPdfToWord: document.getElementById('download-btn-pdf-to-word'),
        processAnotherBtnPdfToWord: document.getElementById('process-another-btn-pdf-to-word'),
        // Image to PDF
        uploadAreaImageToPdf: document.getElementById('upload-area-image-to-pdf'),
        processingAreaImageToPdf: document.getElementById('processing-area-image-to-pdf'),
        resultAreaImageToPdf: document.getElementById('result-area-image-to-pdf'),
        pdfUploadImageToPdf: document.getElementById('pdf-upload-image-to-pdf'),
        browseBtnImageToPdf: document.getElementById('browse-btn-image-to-pdf'),
        fileCountImageToPdf: document.getElementById('file-count-image-to-pdf'),
        fileListImageToPdf: document.getElementById('file-list-image-to-pdf'),
        cancelBtnImageToPdf: document.getElementById('cancel-btn-image-to-pdf'),
        convertBtnImageToPdf: document.getElementById('convert-btn-image-to-pdf'),
        statusTextImageToPdf: document.getElementById('status-text-image-to-pdf'),
        downloadBtnImageToPdf: document.getElementById('download-btn-image-to-pdf'),
        processAnotherBtnImageToPdf: document.getElementById('process-another-btn-image-to-pdf'),
        // Word to PDF
        uploadAreaWordToPdf: document.getElementById('upload-area-word-to-pdf'),
        processingAreaWordToPdf: document.getElementById('processing-area-word-to-pdf'),
        resultAreaWordToPdf: document.getElementById('result-area-word-to-pdf'),
        pdfUploadWordToPdf: document.getElementById('pdf-upload-word-to-pdf'),
        browseBtnWordToPdf: document.getElementById('browse-btn-word-to-pdf'),
        fileNameWordToPdf: document.getElementById('file-name-word-to-pdf'),
        fileSizeWordToPdf: document.getElementById('file-size-word-to-pdf'),
        cancelBtnWordToPdf: document.getElementById('cancel-btn-word-to-pdf'),
        convertBtnWordToPdf: document.getElementById('convert-btn-word-to-pdf'),
        statusTextWordToPdf: document.getElementById('status-text-word-to-pdf'),
        downloadBtnWordToPdf: document.getElementById('download-btn-word-to-pdf'),
        processAnotherBtnWordToPdf: document.getElementById('process-another-btn-word-to-pdf'),
    };

    let selectedFiles = [];

    // --- Tab Switching Logic ---
    Object.keys(tabs).forEach(key => {
        tabs[key].addEventListener('click', () => switchTab(key));
    });

    function switchTab(tabKey) {
        Object.keys(tabs).forEach(key => {
            tabs[key].classList.toggle('active', false); // Deactivate all tabs
            sections[key].classList.toggle('hidden', true); // Hide all sections
        });
        tabs[tabKey].classList.add('active'); // Activate clicked tab
        sections[tabKey].classList.remove('hidden'); // Show corresponding section
        resetAllStates();
    }

    function resetAllStates() {
        // This function now resets all UI sections to their initial state
        Object.keys(ui).forEach(key => {
            if (key.startsWith('uploadArea')) ui[key].classList.remove('hidden');
            if (key.startsWith('processingArea') || key.startsWith('resultArea')) ui[key].classList.add('hidden');
            if (key.startsWith('pdfUpload')) ui[key].value = '';
            if (key.startsWith('statusText')) ui[key].textContent = '';
            if (key.startsWith('compressBtn') || key.startsWith('convertBtn')) {
                ui[key].disabled = false;
                // Reset button text based on its ID
                if (ui[key].id.includes('compress-single')) ui[key].innerHTML = 'Compress PDF';
                if (ui[key].id.includes('compress-multiple')) ui[key].innerHTML = 'Compress Files';
                if (ui[key].id.includes('pdf-to-word')) ui[key].innerHTML = 'Convert to Word';
                if (ui[key].id.includes('image-to-pdf')) ui[key].innerHTML = 'Create PDF';
                if (ui[key].id.includes('word-to-pdf')) ui[key].innerHTML = 'Convert to PDF';
            }
        });
        selectedFiles = [];
    }

    // --- Event Listeners Setup ---
    function setupEventListeners() {
        // Compress Single
        ui.browseBtnCompressSingle.addEventListener('click', () => ui.pdfUploadCompressSingle.click());
        ui.pdfUploadCompressSingle.addEventListener('change', (e) => handleFileSelect(e.target.files, 'compress-single'));
        ui.cancelBtnCompressSingle.addEventListener('click', resetAllStates);
        ui.processAnotherBtnCompressSingle.addEventListener('click', resetAllStates);
        ui.uploadAreaCompressSingle.addEventListener('dragover', (e) => { e.preventDefault(); e.currentTarget.classList.add('dragover'); });
        ui.uploadAreaCompressSingle.addEventListener('dragleave', (e) => { e.preventDefault(); e.currentTarget.classList.remove('dragover'); });
        ui.uploadAreaCompressSingle.addEventListener('drop', (e) => { e.preventDefault(); e.currentTarget.classList.remove('dragover'); handleFileSelect(e.dataTransfer.files, 'compress-single'); });
        ui.compressBtnSingle.addEventListener('click', () => { if (selectedFiles.length > 0) compressSinglePdfHandler(); });

        // Compress Multiple
        ui.browseBtnCompressMultiple.addEventListener('click', () => ui.pdfUploadCompressMultiple.click());
        ui.pdfUploadCompressMultiple.addEventListener('change', (e) => handleFileSelect(e.target.files, 'compress-multiple'));
        ui.cancelBtnCompressMultiple.addEventListener('click', resetAllStates);
        ui.processAnotherBtnCompressMultiple.addEventListener('click', resetAllStates);
        ui.uploadAreaCompressMultiple.addEventListener('dragover', (e) => { e.preventDefault(); e.currentTarget.classList.add('dragover'); });
        ui.uploadAreaCompressMultiple.addEventListener('dragleave', (e) => { e.preventDefault(); e.currentTarget.classList.remove('dragover'); });
        ui.uploadAreaCompressMultiple.addEventListener('drop', (e) => { e.preventDefault(); e.currentTarget.classList.remove('dragover'); handleFileSelect(e.dataTransfer.files, 'compress-multiple'); });
        ui.compressBtnMultiple.addEventListener('click', () => { if (selectedFiles.length > 0) compressPdfBatchToZip(selectedFiles); });

        // PDF to Word
        ui.browseBtnPdfToWord.addEventListener('click', () => ui.pdfUploadPdfToWord.click());
        ui.pdfUploadPdfToWord.addEventListener('change', (e) => handleFileSelect(e.target.files, 'pdf-to-word'));
        ui.cancelBtnPdfToWord.addEventListener('click', resetAllStates);
        ui.processAnotherBtnPdfToWord.addEventListener('click', resetAllStates);
        ui.uploadAreaPdfToWord.addEventListener('dragover', (e) => { e.preventDefault(); e.currentTarget.classList.add('dragover'); });
        ui.uploadAreaPdfToWord.addEventListener('dragleave', (e) => { e.preventDefault(); e.currentTarget.classList.remove('dragover'); });
        ui.uploadAreaPdfToWord.addEventListener('drop', (e) => { e.preventDefault(); e.currentTarget.classList.remove('dragover'); handleFileSelect(e.dataTransfer.files, 'pdf-to-word'); });
        ui.convertBtnPdfToWord.addEventListener('click', () => { if (selectedFiles.length > 0) convertPdfToWord(selectedFiles[0]); });
        
        // Image to PDF
        ui.browseBtnImageToPdf.addEventListener('click', () => ui.pdfUploadImageToPdf.click());
        ui.pdfUploadImageToPdf.addEventListener('change', (e) => handleFileSelect(e.target.files, 'image-to-pdf'));
        ui.cancelBtnImageToPdf.addEventListener('click', resetAllStates);
        ui.processAnotherBtnImageToPdf.addEventListener('click', resetAllStates);
        ui.uploadAreaImageToPdf.addEventListener('dragover', (e) => { e.preventDefault(); e.currentTarget.classList.add('dragover'); });
        ui.uploadAreaImageToPdf.addEventListener('dragleave', (e) => { e.preventDefault(); e.currentTarget.classList.remove('dragover'); });
        ui.uploadAreaImageToPdf.addEventListener('drop', (e) => { e.preventDefault(); e.currentTarget.classList.remove('dragover'); handleFileSelect(e.dataTransfer.files, 'image-to-pdf'); });
        ui.convertBtnImageToPdf.addEventListener('click', () => { if (selectedFiles.length > 0) convertImagesToPdf(selectedFiles); });

        // Word to PDF
        ui.browseBtnWordToPdf.addEventListener('click', () => ui.pdfUploadWordToPdf.click());
        ui.pdfUploadWordToPdf.addEventListener('change', (e) => handleFileSelect(e.target.files, 'word-to-pdf'));
        ui.cancelBtnWordToPdf.addEventListener('click', resetAllStates);
        ui.processAnotherBtnWordToPdf.addEventListener('click', resetAllStates);
        ui.uploadAreaWordToPdf.addEventListener('dragover', (e) => { e.preventDefault(); e.currentTarget.classList.add('dragover'); });
        ui.uploadAreaWordToPdf.addEventListener('dragleave', (e) => { e.preventDefault(); e.currentTarget.classList.remove('dragover'); });
        ui.uploadAreaWordToPdf.addEventListener('drop', (e) => { e.preventDefault(); e.currentTarget.classList.remove('dragover'); handleFileSelect(e.dataTransfer.files, 'word-to-pdf'); });
        ui.convertBtnWordToPdf.addEventListener('click', () => { if (selectedFiles.length > 0) convertWordToPdf(selectedFiles[0]); });
    }

    // --- Core Logic Functions ---
    function handleFileSelect(files, type) {
        if (!files || files.length === 0) return;
        selectedFiles = Array.from(files);

        switch (type) {
            case 'compress-single':
                ui.uploadAreaCompressSingle.classList.add('hidden');
                ui.processingAreaCompressSingle.classList.remove('hidden');
                ui.fileNameCompressSingle.textContent = selectedFiles[0].name;
                ui.fileSizeCompressSingle.textContent = `(${(selectedFiles[0].size / 1024 / 1024).toFixed(2)} MB)`;
                break;
            case 'compress-multiple':
                ui.uploadAreaCompressMultiple.classList.add('hidden');
                ui.processingAreaCompressMultiple.classList.remove('hidden');
                ui.fileCountCompressMultiple.textContent = `${selectedFiles.length} file(s) selected`;
                ui.fileListCompressMultiple.innerHTML = selectedFiles.map(f => `<div>${f.name}</div>`).join('');
                break;
            case 'pdf-to-word':
                ui.uploadAreaPdfToWord.classList.add('hidden');
                ui.processingAreaPdfToWord.classList.remove('hidden');
                ui.fileNamePdfToWord.textContent = selectedFiles[0].name;
                ui.fileSizePdfToWord.textContent = `(${(selectedFiles[0].size / 1024 / 1024).toFixed(2)} MB)`;
                break;
            case 'image-to-pdf':
                ui.uploadAreaImageToPdf.classList.add('hidden');
                ui.processingAreaImageToPdf.classList.remove('hidden');
                ui.fileCountImageToPdf.textContent = `${selectedFiles.length} file(s) selected`;
                ui.fileListImageToPdf.innerHTML = selectedFiles.map(f => `<div>${f.name}</div>`).join('');
                break;
            case 'word-to-pdf':
                ui.uploadAreaWordToPdf.classList.add('hidden');
                ui.processingAreaWordToPdf.classList.remove('hidden');
                ui.fileNameWordToPdf.textContent = selectedFiles[0].name;
                ui.fileSizeWordToPdf.textContent = `(${(selectedFiles[0].size / 1024 / 1024).toFixed(2)} MB)`;
                break;
            default:
                console.error(`Unknown file select type: ${type}`);
        }
    }

    async function compressSinglePdfHandler() {
        const file = selectedFiles[0];
        setLoadingState(ui.compressBtnSingle, true);
        ui.statusTextCompressSingle.textContent = `Compressing ${file.name}...`;
        try {
            const quality = parseFloat(ui.qualitySliderSingle.value);
            const compressedBlob = await compressSinglePdf(file, quality);
            ui.downloadBtnCompressSingle.onclick = () => saveAs(compressedBlob, `compressed_${file.name}`);
            ui.originalSizeSingleEl.textContent = `${(file.size / 1024 / 1024).toFixed(2)} MB`;
            ui.newSizeSingleEl.textContent = `${(compressedBlob.size / 1024 / 1024).toFixed(2)} MB`;
            const reduction = (100 - (compressedBlob.size / file.size * 100));
            ui.reductionPercentSingleEl.textContent = `${reduction.toFixed(1)}%`;
            ui.processingAreaCompressSingle.classList.add('hidden');
            ui.resultAreaCompressSingle.classList.remove('hidden');
        } catch (error) {
            console.error(`Failed to compress ${file.name}:`, error);
            ui.statusTextCompressSingle.textContent = `Skipping ${file.name} due to an error.`;
        } finally {
            setLoadingState(ui.compressBtnSingle, false, 'Compress PDF');
        }
    }

    async function compressPdfBatchToZip(files) {
        setLoadingState(ui.compressBtnMultiple, true);
        const zip = new JSZip();
        let totalOriginalSize = 0;
        let totalNewSize = 0;
        const quality = parseFloat(ui.qualitySliderMultiple.value);
        for (let i = 0; i < files.length; i++) {
            const file = files[i];
            ui.statusTextCompressMultiple.textContent = `Compressing file ${i + 1} of ${files.length}: ${file.name}`;
            try {
                const compressedBlob = await compressSinglePdf(file, quality);
                zip.file(`compressed_${file.name}`, compressedBlob);
                totalOriginalSize += file.size;
                totalNewSize += compressedBlob.size;
            } catch (error) {
                console.error(`Failed to compress ${file.name}:`, error);
                ui.statusTextCompressMultiple.textContent = `Skipping ${file.name} due to an error.`;
            }
        }
        ui.statusTextCompressMultiple.textContent = 'Creating ZIP file...';
        const zipBlob = await zip.generateAsync({ type: "blob" });
        ui.downloadBtnCompressMultiple.onclick = () => saveAs(zipBlob, `compressed_files.zip`);
        ui.originalSizeMultipleEl.textContent = `${(totalOriginalSize / 1024 / 1024).toFixed(2)} MB`;
        ui.newSizeMultipleEl.textContent = `${(totalNewSize / 1024 / 1024).toFixed(2)} MB`;
        const reduction = totalOriginalSize > 0 ? (100 - (totalNewSize / totalOriginalSize * 100)) : 0;
        ui.reductionPercentMultipleEl.textContent = `${reduction.toFixed(1)}%`;
        ui.processingAreaCompressMultiple.classList.add('hidden');
        ui.resultAreaCompressMultiple.classList.remove('hidden');
        setLoadingState(ui.compressBtnMultiple, false, 'Compress Files');
    }

    function compressSinglePdf(file, quality) {
        return new Promise((resolve, reject) => {
            const fileReader = new FileReader();
            fileReader.readAsArrayBuffer(file);
            fileReader.onload = async (e) => {
                try {
                    const typedarray = new Uint8Array(e.target.result);
                    const pdfDoc = await pdfjsLib.getDocument(typedarray).promise;
                    const { jsPDF } = window.jspdf;
                    const firstPage = await pdfDoc.getPage(1);
                    const viewport = firstPage.getViewport({ scale: 1 });
                    const orientation = viewport.width > viewport.height ? 'l' : 'p';
                    const doc = new jsPDF(orientation, 'pt', [viewport.width, viewport.height]);
                    doc.deletePage(1);
                    for (let i = 1; i <= pdfDoc.numPages; i++) {
                        const page = await pdfDoc.getPage(i);
                        const viewport = page.getViewport({ scale: 1 });
                        const canvas = document.createElement('canvas');
                        canvas.width = viewport.width;
                        canvas.height = viewport.height;
                        const context = canvas.getContext('2d');
                        await page.render({ canvasContext: context, viewport: viewport }).promise;
                        const imgData = canvas.toDataURL('image/jpeg', quality);
                        doc.addPage([viewport.width, viewport.height], orientation);
                        doc.addImage(imgData, 'JPEG', 0, 0, viewport.width, viewport.height);
                    }
                    resolve(doc.output('blob'));
                } catch (error) {
                    reject(error);
                }
            };
            fileReader.onerror = reject;
        });
    }

    async function convertPdfToWord(file) {
        setLoadingState(ui.convertBtnPdfToWord, true);
        ui.statusTextPdfToWord.textContent = 'Initializing converter...';

        let worker;
        try {
            ui.statusTextPdfToWord.textContent = 'Loading OCR engine...';
            worker = Tesseract.createWorker({ logger: m => { if (m.status === 'recognizing text') { ui.statusTextPdfToWord.textContent = `OCR Progress: ${Math.round(m.progress * 100)}%`; } } });
            await worker.load();
            await worker.loadLanguage('eng');
            await worker.initialize('eng');
            ui.statusTextPdfToWord.textContent = 'OCR engine loaded. Reading PDF...';

            const fileReader = new FileReader();
            fileReader.readAsArrayBuffer(file);
            fileReader.onload = async (e) => {
                try {
                    const typedarray = new Uint8Array(e.target.result);
                    const pdfDoc = await pdfjsLib.getDocument({ data: typedarray }).promise;
                    const docxContent = [];
                    const scale = 1.5; 

                    for (let i = 1; i <= pdfDoc.numPages; i++) {
                        ui.statusTextPdfToWord.textContent = `Processing page ${i} of ${pdfDoc.numPages}...`;
                        const page = await pdfDoc.getPage(i);
                        const viewport = page.getViewport({ scale: scale });
                        const canvas = document.createElement('canvas');
                        const context = canvas.getContext('2d');
                        canvas.height = viewport.height;
                        canvas.width = viewport.width;
                        await page.render({ canvasContext: context, viewport: viewport }).promise;
                        
                        const pageImageBlob = await new Promise((resolve, reject) => canvas.toBlob(blob => blob ? resolve(blob) : reject(new Error('Canvas toBlob returned null.')), 'image/png'));
                        const pageImageBuffer = await pageImageBlob.arrayBuffer();

                        docxContent.push(new docx.Paragraph({ children: [new docx.ImageRun({ data: pageImageBuffer, transformation: { width: canvas.width / scale, height: canvas.height / scale } })] }));

                        const { data: { text } } = await worker.recognize(canvas);
                        if (text && text.trim().length > 0) {
                            docxContent.push(new docx.Paragraph({ children: [new docx.TextRun({ text: text, italics: true, color: "888888" })] }));
                        }
                    }

                    ui.statusTextPdfToWord.textContent = 'Generating .docx file...';
                    const doc = new docx.Document({ sections: [{ children: docxContent }] });
                    const blob = await docx.Packer.toBlob(doc);
                    const fileName = file.name.replace(/\.pdf$/i, '.docx');
                    ui.downloadBtnPdfToWord.onclick = () => saveAs(blob, fileName);
                    
                    ui.processingAreaPdfToWord.classList.add('hidden');
                    ui.resultAreaPdfToWord.classList.remove('hidden');
                } catch (error) {
                    console.error('Error during file processing:', error);
                    ui.statusTextPdfToWord.textContent = `An error occurred: ${error.message}`;
                } finally {
                    setLoadingState(ui.convertBtnPdfToWord, false, 'Convert to Word');
                }
            };
        } catch (error) {
            console.error('Error initializing OCR or reading file:', error);
            ui.statusTextPdfToWord.textContent = 'Failed to initialize. Please try again.';
            setLoadingState(ui.convertBtnPdfToWord, false, 'Convert to Word');
        } finally {
             if (worker) await worker.terminate();
        }
    }

    async function convertImagesToPdf(files) {
        setLoadingState(ui.convertBtnImageToPdf, true);
        ui.statusTextImageToPdf.textContent = 'Creating PDF...';
        const { jsPDF } = window.jspdf;
        const doc = new jsPDF(); // Creates a doc with one page by default

        for (let i = 0; i < files.length; i++) {
            const file = files[i];
            ui.statusTextImageToPdf.textContent = `Adding image ${i + 1} of ${files.length}...`;
            try {
                const imgData = await new Promise((resolve, reject) => {
                    const reader = new FileReader();
                    reader.onload = e => resolve(e.target.result);
                    reader.onerror = reject;
                    reader.readAsDataURL(file);
                });

                const img = await new Promise((resolve, reject) => {
                    const image = new Image();
                    image.onload = () => resolve(image);
                    image.onerror = reject;
                    image.src = imgData;
                });
                
                // For the first image (i=0), we use the default page.
                // For subsequent images, we add a new page.
                if (i > 0) {
                    doc.addPage();
                }

                const pageWidth = doc.internal.pageSize.getWidth();
                const pageHeight = doc.internal.pageSize.getHeight();
                const imgWidth = img.width;
                const imgHeight = img.height;
                const ratio = Math.min(pageWidth / imgWidth, pageHeight / imgHeight);
                const newWidth = imgWidth * ratio;
                const newHeight = imgHeight * ratio;
                const x = (pageWidth - newWidth) / 2;
                const y = (pageHeight - newHeight) / 2;

                doc.addImage(imgData, 'PNG', x, y, newWidth, newHeight);
            } catch (error) {
                console.error(`Could not add image ${file.name}:`, error);
                ui.statusTextImageToPdf.textContent = `Skipping image ${file.name} due to an error.`;
            }
        }
        
        const pdfBlob = doc.output('blob');
        ui.downloadBtnImageToPdf.onclick = () => saveAs(pdfBlob, 'converted-images.pdf');
        ui.processingAreaImageToPdf.classList.add('hidden');
        ui.resultAreaImageToPdf.classList.remove('hidden');
        setLoadingState(ui.convertBtnImageToPdf, false, 'Create PDF');
    }

    async function convertWordToPdf(file) {
        setLoadingState(ui.convertBtnWordToPdf, true);
        ui.statusTextWordToPdf.textContent = 'Rendering Word document...';
        
        try {
            const arrayBuffer = await file.arrayBuffer();
            
            // Convert DOCX to HTML using Mammoth.js
            const { value: html } = await mammoth.convertToHtml({ arrayBuffer: arrayBuffer });
            
            // Create a temporary element to hold the HTML for conversion
            const renderTarget = document.createElement('div');
            renderTarget.className = 'p-4 bg-white'; // Add some basic styling
            renderTarget.innerHTML = html;
            document.body.appendChild(renderTarget); // Must be in the DOM for html2pdf

            ui.statusTextWordToPdf.textContent = 'Converting to PDF...';
            
            const opt = {
                margin:       1,
                filename:     file.name.replace(/\.(docx|doc)$/i, '.pdf'),
                image:        { type: 'jpeg', quality: 0.98 },
                html2canvas:  { scale: 2, useCORS: true },
                jsPDF:        { unit: 'in', format: 'letter', orientation: 'portrait' }
            };

            const pdfBlob = await html2pdf().from(renderTarget).set(opt).output('blob');
            
            ui.downloadBtnWordToPdf.onclick = () => saveAs(pdfBlob, opt.filename);
            ui.processingAreaWordToPdf.classList.add('hidden');
            ui.resultAreaWordToPdf.classList.remove('hidden');
            
            document.body.removeChild(renderTarget); // Clean up the temporary element

        } catch (error) {
            console.error('Error converting Word to PDF:', error);
            ui.statusTextWordToPdf.textContent = 'An error occurred during conversion. The file format may be unsupported.';
        } finally {
            setLoadingState(ui.convertBtnWordToPdf, false, 'Convert to PDF');
        }
    }


    function setLoadingState(button, isLoading, defaultText) {
        button.disabled = isLoading;
        if (isLoading) {
            button.innerHTML = '<div class="spinner"></div>';
        } else if (defaultText) {
            button.innerHTML = defaultText;
        }
    }

    // --- Initialize Page ---
    window.addEventListener("DOMContentLoaded", function() {
      const savedTheme = localStorage.getItem('portalTheme');
      if (savedTheme) setTheme(savedTheme);
      
      document.getElementById("themeBtn").addEventListener("click", toggleThemeOptions);
      
      document.addEventListener("click", function(e) {
        const themeBtn = document.getElementById("themeBtn");
        const themeOptions = document.getElementById("themeOptions");
        if (themeBtn && !themeBtn.contains(e.target) && themeOptions && !themeOptions.contains(e.target)) {
          themeOptions.classList.remove("show");
        }
      });

      setupEventListeners();
      // Initialize with the first tab active
      switchTab('compressSingle');
    });
</script>
</body>
</html>
